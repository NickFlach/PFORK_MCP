<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP on Replit</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="title-container">
        <img src="/replit.png" alt="Replit" class="logo">
        <h1>MCP on Replit</h1>
    </div>
    <p class="subtitle">Model Context Protocol server built with xmcp</p>
    
    <h2>Development Endpoint</h2>
    <div class="endpoint-container">
        <div class="endpoint" id="mcp-url"></div>
        <button class="copy-btn" onclick="copyToClipboard('mcp-url', this)">Copy</button>
    </div>
    
    <div class="info-box auth-note">
        <strong>Authentication Required:</strong> This server uses API key authentication. 
        Include your API key in the <code>x-api-key</code> header when connecting. 
        See the configuration section below for an example.
    </div>
    
    <div class="section-header">
        <h2>Available Tools</h2>
        <a href="https://xmcp.dev/docs/core-concepts/tools" target="_blank">docs →</a>
    </div>
    <ul class="tool-list" id="tools-list">
        <li style="color: #999;">Loading tools...</li>
    </ul>
    
    <div class="section-header">
        <h2>Available Prompts</h2>
        <a href="https://xmcp.dev/docs/core-concepts/prompts" target="_blank">docs →</a>
    </div>
    <ul class="tool-list" id="prompts-list">
        <li style="color: #999;">Loading prompts...</li>
    </ul>
    
    <div class="section-header">
        <h2>Available Resources</h2>
        <a href="https://xmcp.dev/docs/core-concepts/resources" target="_blank">docs →</a>
    </div>
    <ul class="tool-list" id="resources-list">
        <li style="color: #999;">Loading resources...</li>
    </ul>
    
    <h2>Configuration</h2>
    <p>Add this server to your MCP client configuration:</p>
    <div class="endpoint-container">
        <div class="endpoint config-json" id="config-json"></div>
        <button class="copy-btn" onclick="copyToClipboard('config-json', this)">Copy</button>
    </div>
    
    <h2>Documentation</h2>
    <div class="docs-links">
        <a href="https://xmcp.dev/docs" target="_blank">xmcp Docs</a>
        <a href="https://modelcontextprotocol.io/" target="_blank">MCP Spec</a>
        <a href="https://docs.replit.com" target="_blank">Replit Docs</a>
    </div>

    <script>
        // Get MCP URL from current location
        const mcpUrl = window.location.origin + '/mcp';
        
        // Update endpoint displays
        document.getElementById('mcp-url').textContent = mcpUrl;
        
        // Update configuration JSON
        const configJson = {
            "mcpServers": {
                "my-xmcp-app": {
                    "url": mcpUrl,
                    "headers": {
                        "x-api-key": "your-session-secret"
                    }
                }
            }
        };
        document.getElementById('config-json').textContent = JSON.stringify(configJson, null, 2);
        
        // Load available tools dynamically
        async function loadTools() {
            try {
                const response = await fetch('/api/tools');
                const tools = await response.json();
                
                const toolsList = document.getElementById('tools-list');
                
                if (tools.length === 0) {
                    toolsList.innerHTML = '<li style="color: #999;">No tools available</li>';
                    return;
                }
                
                toolsList.innerHTML = tools.map(tool => `
                    <li>
                        <div class="tool-name">${tool.name}</div>
                        <div class="tool-desc">${tool.description || 'No description available'}</div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Failed to load tools:', error);
                document.getElementById('tools-list').innerHTML = 
                    '<li style="color: #999;">Failed to load tools</li>';
            }
        }
        
        // Load available prompts dynamically
        async function loadPrompts() {
            try {
                const response = await fetch('/api/prompts');
                const prompts = await response.json();
                
                const promptsList = document.getElementById('prompts-list');
                
                if (prompts.length === 0) {
                    promptsList.innerHTML = '<li style="color: #999;">No prompts available</li>';
                    return;
                }
                
                promptsList.innerHTML = prompts.map(prompt => `
                    <li>
                        <div class="tool-name">${prompt.name}</div>
                        <div class="tool-desc">${prompt.description || 'No description available'}</div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Failed to load prompts:', error);
                document.getElementById('prompts-list').innerHTML = 
                    '<li style="color: #999;">Failed to load prompts</li>';
            }
        }
        
        // Load available resources dynamically
        async function loadResources() {
            try {
                const response = await fetch('/api/resources');
                const resources = await response.json();
                
                const resourcesList = document.getElementById('resources-list');
                
                if (resources.length === 0) {
                    resourcesList.innerHTML = '<li style="color: #999;">No resources available</li>';
                    return;
                }
                
                resourcesList.innerHTML = resources.map(resource => `
                    <li>
                        <div class="tool-name">${resource.name}</div>
                        <div class="tool-desc">${resource.description || 'No description available'}</div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Failed to load resources:', error);
                document.getElementById('resources-list').innerHTML = 
                    '<li style="color: #999;">Failed to load resources</li>';
            }
        }
        
        // Load all data on page load
        loadTools();
        loadPrompts();
        loadResources();
        
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                button.textContent = 'Error';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }
    </script>
</body>
</html>
